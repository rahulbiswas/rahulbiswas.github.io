<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Confidence Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #f8f9fa;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        h1 {
            margin-top: 0;
            color: #2c3e50;
            font-weight: 600;
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        input[type="range"] {
            flex-grow: 1;
            width: 100%;
        }
        input[type="number"] {
            width: 70px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 1em;
        }
        .stats, .results {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #eee;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .stat-item span:first-child {
            font-weight: 500;
        }
        #confidence-meter {
            border: 2px solid #ccc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            transition: all 0.3s ease-in-out;
        }
        #confidence-meter.red { border-color: #e74c3c; background-color: #e74c3c1a; }
        #confidence-meter.yellow { border-color: #f39c12; background-color: #f39c121a; }
        #confidence-meter.green { border-color: #2ecc71; background-color: #2ecc711a; }

        #confidence-level {
            font-size: 2.5em;
            margin: 0;
            font-weight: 700;
        }
        #confidence-text {
            font-size: 1.2em;
            margin-top: 5px;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Bayesian Confidence Calculator</h1>

        <div class="input-section">
            <div class="input-group">
                <label for="successes">Successes</label>
                <div class="slider-container">
                    <input type="range" id="successesSlider" min="0" max="500" value="0" oninput="updateFromSlider('successes')">
                    <input type="number" id="successes" min="0" max="500" value="0" oninput="updateCalculator()">
                </div>
            </div>
            <div class="input-group">
                <label for="failures">Failures</label>
                <div class="slider-container">
                    <input type="range" id="failuresSlider" min="0" max="500" value="0" oninput="updateFromSlider('failures')">
                    <input type="number" id="failures" min="0" max="500" value="0" oninput="updateCalculator()">
                </div>
            </div>
             <div class="input-group">
                <label for="threshold">Hypothesis Threshold (%)</label>
                <div class="slider-container">
                    <input type="range" id="thresholdSlider" min="0" max="100" value="20" oninput="updateFromSlider('threshold')">
                    <input type="number" id="threshold" min="0" max="100" value="20" oninput="updateCalculator()">
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span>Total Trials:</span>
                <span id="totalTrials">0</span>
            </div>
            <div class="stat-item">
                <span>Observed Success Rate:</span>
                <span id="observedRate">--%</span>
            </div>
        </div>
        
        <div id="confidence-meter" class="red">
            <h2 id="confidence-level">--%</h2>
            <p id="confidence-text">Waiting for data...</p>
        </div>

        <div class="results">
             <div class="stat-item">
                <span id="probGreaterLabel">Probability true rate is > 20%:</span>
                <span id="probGreater">--%</span>
            </div>
             <div class="stat-item">
                <span id="probLessLabel">Probability true rate is < 20%:</span>
                <span id="probLess">--%</span>
            </div>
        </div>
    </div>

    <script>
        function updateCalculator() {
            const successesInput = document.getElementById('successes');
            const failuresInput = document.getElementById('failures');
            const thresholdInput = document.getElementById('threshold');
            
            const successes = parseInt(successesInput.value) || 0;
            const failures = parseInt(failuresInput.value) || 0;
            const thresholdPercent = parseInt(thresholdInput.value) || 0;
            const threshold = thresholdPercent / 100.0;

            document.getElementById('successesSlider').value = successes;
            document.getElementById('failuresSlider').value = failures;
            document.getElementById('thresholdSlider').value = thresholdPercent;

            const total = successes + failures;

            const totalTrialsEl = document.getElementById('totalTrials');
            const observedRateEl = document.getElementById('observedRate');
            const meterEl = document.getElementById('confidence-meter');
            const meterLevelEl = document.getElementById('confidence-level');
            const meterTextEl = document.getElementById('confidence-text');
            const probGreaterEl = document.getElementById('probGreater');
            const probLessEl = document.getElementById('probLess');
            const probGreaterLabelEl = document.getElementById('probGreaterLabel');
            const probLessLabelEl = document.getElementById('probLessLabel');

            probGreaterLabelEl.textContent = `Probability true rate is > ${thresholdPercent}%:`;
            probLessLabelEl.textContent = `Probability true rate is < ${thresholdPercent}%:`;

            if (total === 0) {
                totalTrialsEl.textContent = '0';
                observedRateEl.textContent = '--%';
                meterLevelEl.textContent = '--%';
                meterTextEl.textContent = 'Waiting for data...';
                probGreaterEl.textContent = '--%';
                probLessEl.textContent = '--%';
                meterEl.className = 'red';
                return;
            }

            const observedRate = (successes / total) * 100;
            totalTrialsEl.textContent = total;
            observedRateEl.textContent = observedRate.toFixed(1) + '%';
            
            // Bayesian calculation using a uniform prior (Beta(1,1))
            const alpha = successes + 1;
            const beta = failures + 1;
            
            const probLessThanThreshold = jStat.beta.cdf(threshold, alpha, beta);
            const probGreaterThanThreshold = 1 - probLessThanThreshold;

            probGreaterEl.textContent = (probGreaterThanThreshold * 100).toFixed(1) + '%';
            probLessEl.textContent = (probLessThanThreshold * 100).toFixed(1) + '%';

            const confidence = Math.max(probLessThanThreshold, probGreaterThanThreshold) * 100;
            meterLevelEl.textContent = confidence.toFixed(1) + '%';

            meterEl.className = ''; // Clear classes
            if (confidence >= 90) {
                meterEl.classList.add('green');
                if (probGreaterThanThreshold > probLessThanThreshold) {
                    meterTextEl.textContent = `High Confidence: Rate is likely > ${thresholdPercent}%`;
                } else {
                    meterTextEl.textContent = `High Confidence: Rate is likely < ${thresholdPercent}%`;
                }
            } else if (confidence >= 80) {
                meterEl.classList.add('yellow');
                meterTextEl.textContent = 'Getting warmer... need more data.';
            } else {
                meterEl.classList.add('red');
                meterTextEl.textContent = 'Signal is too noisy!';
            }
        }

        function updateFromSlider(inputId) {
            document.getElementById(inputId).value = document.getElementById(inputId + 'Slider').value;
            updateCalculator();
        }

        // Initial call to set the default state
        updateCalculator();
    </script>

</body>
</html>
