<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tic Tac Toe</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        .game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f3f4f6;
            margin: 0;
        }
        .game-board {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        canvas {
            border: 1px dashed #ccc;
        }
        .turn-indicator {
            margin-top: 1rem;
            text-align: center;
            font-size: 1.125rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const TicTacToe = () => {
            const canvasRef = React.useRef(null);
            const [turn, setTurn] = React.useState(0);
            const [previousSquares, setPreviousSquares] = React.useState({});

            // Draw initial board
            React.useEffect(() => {
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');

                context.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw grid lines
                context.lineWidth = 4;
                context.strokeStyle = 'rgb(60,60,60)';
                
                // Vertical lines
                context.beginPath();
                context.moveTo(100, 10);
                context.lineTo(100, 280);
                context.stroke();
                
                context.beginPath();
                context.moveTo(190, 10);
                context.lineTo(190, 280);
                context.stroke();
                
                // Horizontal lines
                context.beginPath();
                context.moveTo(10, 100);
                context.lineTo(280, 100);
                context.stroke();
                
                context.beginPath();
                context.moveTo(10, 190);
                context.lineTo(280, 190);
                context.stroke();
            }, []);

            // Redraw all moves when state changes
            React.useEffect(() => {
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');

                Object.entries(previousSquares).forEach(([square, playerTurn]) => {
                    const squareNum = parseInt(square);
                    const middleX = 55 + (squareNum % 3) * 90;
                    const middleY = 55 + Math.floor(squareNum / 3) * 90;

                    context.beginPath();
                    if (playerTurn === 0) {
                        // Draw X
                        context.strokeStyle = 'rgb(200,60,60)';
                        context.moveTo(middleX - 30, middleY - 30);
                        context.lineTo(middleX + 30, middleY + 30);
                        context.stroke();
                        context.moveTo(middleX + 30, middleY - 30);
                        context.lineTo(middleX - 30, middleY + 30);
                        context.stroke();
                    } else {
                        // Draw O
                        context.strokeStyle = 'rgb(60,60,200)';
                        context.moveTo(middleX + 35, middleY);
                        context.arc(middleX, middleY, 35, 0, 2 * Math.PI);
                        context.stroke();
                    }
                });

                // Check for winners and draw winning lines
                context.beginPath();
                context.strokeStyle = 'rgb(0,0,0)';
                
                for (let player = 0; player < 2; player++) {
                    // Check horizontal wins
                    for (let row = 0; row < 3; row++) {
                        if (
                            previousSquares[3 * row] === player &&
                            previousSquares[3 * row + 1] === player &&
                            previousSquares[3 * row + 2] === player
                        ) {
                            context.moveTo(10, 55 + 90 * row);
                            context.lineTo(280, 55 + 90 * row);
                            context.stroke();
                        }
                    }

                    // Check vertical wins
                    for (let col = 0; col < 3; col++) {
                        if (
                            previousSquares[col] === player &&
                            previousSquares[col + 3] === player &&
                            previousSquares[col + 6] === player
                        ) {
                            context.moveTo(55 + 90 * col, 10);
                            context.lineTo(55 + 90 * col, 280);
                            context.stroke();
                        }
                    }

                    // Check diagonal wins
                    if (
                        previousSquares[0] === player &&
                        previousSquares[4] === player &&
                        previousSquares[8] === player
                    ) {
                        context.moveTo(10, 10);
                        context.lineTo(280, 280);
                        context.stroke();
                    }

                    if (
                        previousSquares[2] === player &&
                        previousSquares[4] === player &&
                        previousSquares[6] === player
                    ) {
                        context.moveTo(280, 10);
                        context.lineTo(10, 280);
                        context.stroke();
                    }
                }
            }, [previousSquares]);

            const handleCanvasClick = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                let square = -1;
                if (clickX < 100) {
                    if (clickY < 100) square = 0;
                    else if (clickY < 190) square = 3;
                    else square = 6;
                } else if (clickX < 190) {
                    if (clickY < 100) square = 1;
                    else if (clickY < 190) square = 4;
                    else square = 7;
                } else {
                    if (clickY < 100) square = 2;
                    else if (clickY < 190) square = 5;
                    else square = 8;
                }

                // Check if square is already taken
                if (square in previousSquares) {
                    return;
                }

                // Update game state
                setPreviousSquares(prev => ({
                    ...prev,
                    [square]: turn
                }));
                setTurn(1 - turn);
            };

            return (
                <div className="game-container">
                    <div className="game-board">
                        <canvas
                            ref={canvasRef}
                            width={290}
                            height={290}
                            onClick={handleCanvasClick}
                        />
                        <div className="turn-indicator">
                            {`Current Turn: ${turn === 0 ? 'X' : 'O'}`}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TicTacToe />);
    </script>
</body>
</html>